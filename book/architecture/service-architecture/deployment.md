# Deployment

Writing a service is only half the battle, the service still needs to be run somewhere and deploying services by hand is almost impossible when you have hundreds of services. In this chapter we will explain how and where services are deployed.

Services are run on what we call "machine classes", these are auto-scaling groups that can contain many different services. Each machine class typically contains an auto-scaling group that starts with the prefix `h2o-` and contains a number of instances (in live the count is some multiple of 3 which ensures that we have the same number of instances in each AZ).

The process for service deployment involves two services which are installed by puppet when the platform is created, the provisioning manager service and the provisioning service. The provisioning manager service runs on the `h2o-kernel` machine class and acts as a CRUD service for managing what services should be provisioned, the list of services and versions are stored in Cassandra. The provisioning service is an agent that runs on every h2o instance and is purpose is to manage which services are running on each instance, to do this it periodically fetches the list of services that should be running on that instance (based on the machine class name of the instance, for example if the instance ASG is named `h2o-flow1` then the provisioning service will look for services that should be provisioned in the `flow1` machine class`). The service then installs an upstart script for any service that should be running that and then cleans up any old upstart files to shut down any old services.
